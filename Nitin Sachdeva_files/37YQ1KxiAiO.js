if (self.CavalryLogger) { CavalryLogger.start_js(["GjcJG"]); }

__d('htmlize',['htmlSpecialChars'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){return c('htmlSpecialChars')(i).replace(/\r\n|[\r\n]/g,'<br/>');}f.exports=h;},null);
__d('createIxElement',['invariant','DOM','joinClasses'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();function i(j,k){var l='img',m;!(j.sprited||j.uri)?h(0):void 0;if(j.sprited){l=c('joinClasses')(l,j.spriteMapCssClass,j.spriteCssClass);m=c('DOM').create('i',{className:l});if(k!=null)c('DOM').setContent(m,c('DOM').create('u',null,k));}else if(j.uri){m=c('DOM').create('img',{className:l,src:j.uri});if(k!=null)m.setAttribute('alt',k);if(j.width)m.setAttribute('width',j.width);if(j.height)m.setAttribute('height',j.height);}return m;}f.exports=i;},null);
__d('BasicTypeaheadRenderer',['BadgeHelper','DOM'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=' \u00B7 ';function i(j,k){var l=[];if(j.icon)l.push(c('DOM').create('img',{alt:'',src:j.icon}));var m=j.debug_info;if(m)l.push(c('DOM').create('span',{className:'debugInfo'},m));if(j.text){var n=[j.text];if(j.is_verified)n.push(c('BadgeHelper').renderBadge('xsmall','verified'));l.push(c('DOM').create('span',{className:'text'},n));}if(j.subtext){var o=[j.subtext];if(j.saved_context){var p=c('DOM').create('span',{className:'saved'},[j.saved_context]);o.unshift(p,h);}l.push(c('DOM').create('span',{className:'subtext'},o));}var q=c('DOM').create('li',{className:j.type||''},l);if(j.text){q.setAttribute('title',j.text);q.setAttribute('aria-label',j.text);}return q;}i.className='basic';f.exports=i;},null);
__d('TypeaheadView',['ix','$','ArbiterMixin','BasicTypeaheadRenderer','CSS','DOM','Event','Parent','createIxElement','emptyFunction','getElementText','getOrCreateDOMID','mixin'],function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('mixin')(c('ArbiterMixin')));j=i&&i.prototype;function k(l,m){'use strict';j.constructor.call(this);this.element=this.content=c('$')(l);Object.assign(this,m);}k.prototype.init=function(){'use strict';this.init=c('emptyFunction');this.initializeEvents();this.reset();};k.prototype.initializeEvents=function(){'use strict';c('Event').listen(this.element,{mouseup:this.mouseup.bind(this),mouseover:this.mouseover.bind(this)});};k.prototype.setTypeahead=function(l){'use strict';this.typeahead=l;};k.prototype.setAccessibilityControlElement=function(l){'use strict';this.accessibilityElement=l;};k.prototype.getElement=function(){'use strict';return this.element;};k.prototype.mouseup=function(event){'use strict';if(event.button!=2){this.select(true);event.prevent();}};k.prototype.mouseover=function(event){'use strict';if(this.ignoreMouseover){this.ignoreMouseover=false;return;}if(this.visible)this.highlight(this.getIndex(event));};k.prototype.reset=function(l){'use strict';if(!l)this.disableAutoSelect=false;this.index=-1;this.items=[];this.results=[];this.value='';this.content.innerHTML='';this.inform('reset');return this;};k.prototype.getIndex=function(event){'use strict';return this.items.indexOf(c('Parent').byTag(event.getTarget(),'li'));};k.prototype.getSelection=function(){'use strict';var l=this.results[this.index]||null;return this.visible?l:null;};k.prototype.isEmpty=function(){'use strict';return !this.results.length;};k.prototype.isVisible=function(){'use strict';return !!this.visible;};k.prototype.show=function(){'use strict';c('CSS').show(this.element);if(this.results&&this.results.length)if(this.autoSelect&&this.accessibilityElement&&this.selected)this.accessibilityElement.setAttribute('aria-activedescendant',c('getOrCreateDOMID')(this.selected));this.accessibilityElement&&this.accessibilityElement.setAttribute('aria-expanded','true');this.visible=true;return this;};k.prototype.hide=function(){'use strict';c('CSS').hide(this.element);if(this.accessibilityElement){this.accessibilityElement.setAttribute('aria-expanded','false');this.accessibilityElement.removeAttribute('aria-activedescendant');}this.visible=false;return this;};k.prototype.render=function(l,m,n){'use strict';this.value=l;if(!m.length){this.accessibilityElement&&this.accessibilityElement.removeAttribute('aria-activedescendant');this.reset(true);return;}var o={results:m,value:l};this.inform('beforeRender',o);m=o.results;var p=n&&this.index!=-1?this.index:this.getDefaultIndex(m);this.results=m;c('DOM').setContent(this.content,this.buildResults(m));this.items=this.getItems();this.highlight(p,false);this.inform('render',this.results);};k.prototype.getItems=function(){'use strict';return c('DOM').scry(this.content,'li');};k.prototype.buildResults=function(l){'use strict';var m,n=null;if(typeof this.renderer=='function'){m=this.renderer;n=this.renderer.className||'';}else{m=b.TypeaheadRenderers[this.renderer];n=this.renderer;}m=m.bind(this);var o=l.map(function(q,r){var s=q.node||m(q,r);s.setAttribute('role','option');return s;}),p=c('DOM').create('ul',{className:n,id:'typeahead_list_'+(this.typeahead?c('getOrCreateDOMID')(this.typeahead):c('getOrCreateDOMID')(this.element))},o);p.setAttribute('role','listbox');return p;};k.prototype.showLoadingIndicator=function(){'use strict';var l=c('createIxElement')(h('/images/loaders/indicator_blue_small.gif')),m=c('DOM').create('li',{className:'typeaheadViewInternalLoading'},l),n=c('DOM').create('ul',{role:'listbox'},m);c('DOM').setContent(this.content,n);};k.prototype.getDefaultIndex=function(){'use strict';var l=this.autoSelect&&!this.disableAutoSelect;return this.index<0&&!l?-1:0;};k.prototype.next=function(){'use strict';this.highlight(this.index+1);this.inform('next',this.selected);};k.prototype.prev=function(){'use strict';this.highlight(this.index-1);this.inform('prev',this.selected);};k.prototype.getItemText=function(l){'use strict';var m='';if(l){m=l.getAttribute('aria-label');if(!m){m=c('getElementText')(l);l.setAttribute('aria-label',m);}}return m;};k.prototype.setIsViewingSelectedItems=function(l){'use strict';this.viewingSelected=l;return this;};k.prototype.getIsViewingSelectedItems=function(){'use strict';return !!this.viewingSelected;};k.prototype.highlight=function(l,m){'use strict';if(this.selected){c('CSS').removeClass(this.selected,'selected');this.selected.setAttribute('aria-selected','false');}if(l>this.items.length-1){l=-1;}else if(l<-1)l=this.items.length-1;if(l>=0&&l<this.items.length){this.selected=this.items[l];c('CSS').addClass(this.selected,'selected');this.selected.setAttribute('aria-selected','true');if(this.accessibilityElement)setTimeout(function(){this.accessibilityElement.setAttribute('aria-activedescendant',c('getOrCreateDOMID')(this.selected));}.bind(this),0);}else this.accessibilityElement&&this.accessibilityElement.removeAttribute('aria-activedescendant');this.index=l;this.disableAutoSelect=l==-1;if(m!==false)this.inform('highlight',{index:l,selected:this.results[l],element:this.selected});};k.prototype.select=function(l){'use strict';if(this.headerIndex&&l)return;var m=this.index,n=this.results[m],o=this.element.getAttribute('id');if(n){var p=function(q){this.inform('select',{index:m,clicked:!!l,selected:q,id:o,query:this.value});this.inform('afterSelect');}.bind(this);if(this.shouldValidateTypeaheadSelection(n)){this.validateTypeaheadSelection(n,p);}else p(n);}};k.prototype.shouldValidateTypeaheadSelection=function(l){'use strict';return false;};k.prototype.validateTypeaheadSelection=function(l,m){'use strict';};Object.assign(k.prototype,{events:['highlight','render','reset','select','beforeRender','next','prev'],renderer:c('BasicTypeaheadRenderer'),autoSelect:false,ignoreMouseover:false});f.exports=k;},null);
__d('BucketedTypeaheadView',['fbt','DOM','TypeaheadView'],function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('TypeaheadView'));j=i&&i.prototype;k.prototype.render=function(l,m,n,o){'use strict';var p=m.length>0;for(var q=0;q<m.length;++q)if(m[q].type!=='hashtag')p=false;if(!p)m=this.buildBuckets(l,m);if(n&&o){var r=this.results.length-this.index;this.index=m.length-r;}return j.render.call(this,l,m,n);};k.prototype.highlight=function(l,m){'use strict';this.headerIndex=false;if(l==-1&&this.index!==0)l=this.index;while(l>=0&&l<this.items.length&&!this.isHighlightable(this.results[l])){l=l+1;this.headerIndex=true;}j.highlight.call(this,l,m);};k.prototype.buildBuckets=function(l,m){'use strict';if(!this.typeObjects||!m||!m.length)return m;var n=[],o={};for(var p=0;p<m.length;++p){var q=m[p],r=q.render_type||q.type;if(!o.hasOwnProperty(r)){o[r]=n.length;n.push([this.buildBucketHeader(r)]);}q.classNames=q.classNames||r;q.groupIndex=o[r];q.indexInGroup=n[q.groupIndex].length-1;q.globalIndex=p;n[q.groupIndex].push(q);}for(r in this.typeObjects)if(!o.hasOwnProperty(r)&&this.typeObjects[r].show_always){o[r]=n.length;n.push([this.buildBucketHeader(r)]);q=this.buildNoResultsEntry();q.classNames=q.type;q.groupIndex=o[r];q.indexInGroup=n[q.groupIndex].length-1;n[q.groupIndex].push(q);}var s=[];if(this.typeObjectsOrder){for(var t=0;t<this.typeObjectsOrder.length;++t){var u=this.typeObjectsOrder[t];if(o.hasOwnProperty(u))s=s.concat(n[o[u]]);}}else for(var v=0;v<n.length;++v)s=s.concat(n[v]);return s;};k.prototype.buildNoResultsEntry=function(){'use strict';return {uid:'disabled_result',type:'disabled_result',text:h._("No Results")};};k.prototype.buildBucketHeader=function(l){'use strict';var m=this.typeObjects[l];if(m===undefined)throw new Error(l+" is undefined in "+JSON.stringify(this.typeObjects));if(m.markup){m.text=m.markup;delete m.markup;}return this.typeObjects[l];};k.prototype.buildResults=function(l){'use strict';var m=j.buildResults.call(this,l);if(this.typeObjects){return c('DOM').create('div',{className:'bucketed'},[m]);}else return m;};k.prototype.isHighlightable=function(l){'use strict';return l.type!='header'&&l.type!='disabled_result';};k.prototype.select=function(l){'use strict';var m=this.results[this.index];if(m&&this.isHighlightable(m))j.select.call(this,l);};k.prototype.updateResults=function(l){'use strict';this.results=l;};k.prototype.normalizeIndex=function(l){'use strict';var m=this.results.length;if(m===0){return -1;}else if(l<-1){return l%m+m+1;}else if(l>=m){return l%m-1;}else return l;};k.prototype.getDefaultIndex=function(l){'use strict';var m=this.autoSelect&&!this.disableAutoSelect;if(this.index<0&&!m)return -1;if(l.length===0)return -1;var n=0;while(!this.isHighlightable(l)&&n<l.length)n++;return n;};k.prototype.prev=function(){'use strict';var l=this.results[this.normalizeIndex(this.index-1)];while(l&&!this.isHighlightable(l)){this.index=this.normalizeIndex(this.index-1);l=this.results[this.normalizeIndex(this.index-1)];}return j.prev.call(this);};k.prototype.next=function(){'use strict';var l=this.results[this.normalizeIndex(this.index+1)];while(l&&!this.isHighlightable(l)){this.index=this.normalizeIndex(this.index+1);l=this.results[this.normalizeIndex(this.index+1)];}return j.next.call(this);};function k(){'use strict';i.apply(this,arguments);}f.exports=k;},null);
__d('ContextualTypeaheadView',['BucketedTypeaheadView','CSS','ContextualLayer','ContextualLayerAutoFlip','ContextualLayerHideOnScroll','DOM','DOMDimensions','Style'],function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('BucketedTypeaheadView'));i=h&&h.prototype;j.prototype.init=function(){'use strict';this.initializeLayer();i.init.call(this);};j.prototype.initializeLayer=function(){'use strict';this.context=this.getContext();this.wrapper=c('DOM').create('div');c('DOM').appendContent(this.wrapper,this.element);c('CSS').addClass(this.element,'uiContextualTypeaheadView');this.layer=new (c('ContextualLayer'))({context:this.context,position:'below',alignment:this.alignment,causalElement:this.causalElement,permanent:true,shouldSetARIAProperties:false},this.wrapper);this.layer.enableBehavior(c('ContextualLayerHideOnScroll'));if(c('Style').isFixed(this.context)||this.autoflip)this.layer.enableBehavior(c('ContextualLayerAutoFlip'));this.subscribe('render',this.renderLayer.bind(this));};j.prototype.show=function(){'use strict';if(this.minWidth){c('Style').set(this.wrapper,'min-width',this.minWidth+'px');}else if(this.width){c('Style').set(this.wrapper,'width',this.width+'px');}else c('Style').set(this.wrapper,'width',c('DOMDimensions').getElementDimensions(this.context).width+'px');var k=i.show.call(this);this.layer.show();this.inform('show');return k;};j.prototype.hide=function(){'use strict';this.layer.hide();this.inform('hide');return i.hide.call(this);};j.prototype.renderLayer=function(){'use strict';if(!this.isVisible())return;if(this.layer.isShown()){this.layer.updatePosition();}else this.layer.show();};j.prototype.clearText=function(){'use strict';this.layer.getCausalElement().value='';};j.prototype.getContext=function(){'use strict';return this.element.parentNode;};function j(){'use strict';h.apply(this,arguments);}f.exports=j;},null);
__d('Typeahead',['ArbiterMixin','BehaviorsMixin','DataStore','DOM','Event','Parent','Run','Style','emptyFunction','ge','mixin'],function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('mixin')(c('ArbiterMixin'),c('BehaviorsMixin')));i=h&&h.prototype;function j(k,l,m,n){'use strict';i.constructor.call(this);this.args={data:k,view:l,core:m};c('DataStore').set(n,'Typeahead',this);this.element=n;}j.prototype.init=function(k){'use strict';this.init=c('emptyFunction');this.getCore();this.getView().setAccessibilityControlElement(this.getCore().getElement());this.proxyEvents();this.initBehaviors(k||[]);this.inform('init',this);this.data.bootstrap();this.core.focus();};j.prototype.getData=function(){'use strict';if(!this.data){var k=this.args.data;this.data=k;this.data.init();}return this.data;};j.prototype.getView=function(){'use strict';if(!this.view){var k=this.args.view,l=k.node||c('ge')(k.node_id);if(!l){l=c('DOM').create('div',{className:'uiTypeaheadView'});c('DOM').appendContent(this.element,l);}if(typeof k.ctor==='string'){this.view=new window[k.ctor](l,k.options||{});}else this.view=new k.ctor(l,k.options||{});this.view.init();this.view.setTypeahead(this.element);}return this.view;};j.prototype.getCore=function(){'use strict';if(!this.core){var k=this.args.core;if(typeof k.ctor==='string'){this.core=new window[k.ctor](k.options||{});}else this.core=new k.ctor(k.options||{});this.core.init(this.getData(),this.getView(),this.getElement());}return this.core;};j.prototype.getElement=function(){'use strict';return this.element;};j.prototype.setHeight=function(k){'use strict';if(k!=='auto')k=k+'px';c('Style').set(this.element,'height',k);};j.prototype.swapData=function(k){'use strict';return this.$Typeahead1(k,true);};j.prototype.swapDataNoCoreReset=function(k){'use strict';return this.$Typeahead1(k,false);};j.prototype.$Typeahead1=function(k,l){'use strict';var m=this.core;this.data=this.args.data=k;k.init();if(m){m.data=k;m.initData();if(l)m.reset();this.proxyEvents();}k.bootstrap();return k;};j.prototype.proxyEvents=function(){'use strict';[this.data,this.view,this.core].forEach(function(k){k.subscribe(k.events,this.inform.bind(this));},this);};j.prototype.initBehaviors=function(k){'use strict';k.forEach(function(l){if(typeof l==='string'){if(b.TypeaheadBehaviors&&b.TypeaheadBehaviors[l]){b.TypeaheadBehaviors[l](this);}else c('Run').onLoad(function(){if(b.TypeaheadBehaviors)(b.TypeaheadBehaviors[l]||c('emptyFunction'))(this);}.bind(this));}else this.enableBehavior(l);},this);};j.getInstance=function(k){'use strict';var l=c('Parent').byClass(k,'uiTypeahead');return l?c('DataStore').get(l,'Typeahead'):null;};j.initNow=function(k,l,m){'use strict';if(m)m.init(k);k.init(l);};j.init=function(k,l,m,n){'use strict';if(!c('DOM').isNodeOfType(k,['input','textarea']))k=c('DOM').scry(k,'input')[0]||c('DOM').scry(k,'textarea')[0];var o=false;try{o=document.activeElement===k;}catch(p){}if(o){j.initNow(l,m,n);}else var q=c('Event').listen(k,'focus',function(){j.initNow(l,m,n);q.remove();});};f.exports=j;},null);
__d('TypeaheadCore',['Arbiter','ArbiterMixin','CSS','DOM','Event','Focus','Input','InputSelection','Keys','StickyPlaceholderInput','UserAgent_DEPRECATED','bind','emptyFunction','mixin'],function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function j(k){'use strict';i.constructor.call(this);Object.assign(this,k);}j.prototype.init=function(k,l,m){'use strict';this.init=c('emptyFunction');this.data=k;this.view=l;this.root=m;this.initInput();this.inputWrap=c('DOM').find(m,'div.wrap');this.hiddenInput=c('DOM').find(m,'input.hiddenInput');this.value='';this.nextQuery=null;this.selectedText=null;if(this.setValueOnSelect&&c('CSS').hasClass(this.inputWrap,'selected'))this.selectedText=this.getValue();this.initView();this.initData();this.initEvents();this.initToggle();this._exclusions=[];};j.prototype.initInput=function(){'use strict';this.element=c('DOM').find(this.root,'.textInput');var k=c('DOM').scry(this.element,'input')[0];if(k)this.element=k;};j.prototype.initView=function(){'use strict';this.view.subscribe('highlight',c('Focus').set.bind(null,this.element));this.view.subscribe('select',function(k,l){this.select(l.selected);}.bind(this));this.view.subscribe('afterSelect',function(){this.afterSelect();}.bind(this));};j.prototype.initData=function(){'use strict';this.data.subscribe('notify',function(k,l){if(this.root.id==l.rootid&&!this.element.disabled&&l.value==this.getValue())this.view.render(l.value,l.results,l.isAsync);}.bind(this));this.data.subscribe('respond',function(k,l){if(l.forceDisplay||l.value==this.getValue()&&!this.element.disabled&&(this.element.getAttribute('singlestate')!=='true'||l.nullState))this.view.render(l.value,l.results,l.isAsync);}.bind(this));this.data.subscribe('activity',function(k,l){this.fetching=l.activity;if(!this.fetching)this.nextQuery&&this.performQuery();if(this.loading!=this.fetching){this.loading=this.fetching;this.inform('loading',{loading:this.loading});}}.bind(this));};j.prototype.initEvents=function(){'use strict';c('Event').listen(this.view.getElement(),{mouseup:this.viewMouseup.bind(this),mousedown:this.viewMousedown.bind(this)});var k={blur:c('bind')(this,'blur'),focus:c('bind')(this,'focus'),click:c('bind')(this,'click'),keyup:c('bind')(this,'keyup'),keydown:c('bind')(this,'keydown'),keypress:c('bind')(this,'keypress')};if(c('UserAgent_DEPRECATED').firefox())k.input=k.keyup;c('Event').listen(this.element,k);};j.prototype.initToggle=function(){'use strict';this.subscribe('blur',this.view.hide.bind(this.view));this.subscribe('focus',this.view.show.bind(this.view));};j.prototype.viewMousedown=function(){'use strict';this.selecting=true;};j.prototype.viewMouseup=function(){'use strict';this.selecting=false;};j.prototype.blur=function(){'use strict';if(this.selecting){this.selecting=false;return;}this.inform('blur');};j.prototype.click=function(){'use strict';var k=c('InputSelection').get(this.element);if(k.start==k.end)this.element.select();this.inform('click');};j.prototype.focus=function(){'use strict';this.checkValue();this.inform('focus');};j.prototype.keyup=function(){'use strict';if(this.resetOnKeyup&&!this.getValue())this.view.reset();this.checkValue();if(this.getValue().length===0)this.inform('change',null);};j.prototype.keydown=function(event){'use strict';if(!this.view.isVisible()||this.view.isEmpty()){setTimeout(this.checkValue.bind(this),0);return;}switch(c('Event').getKeyCode(event)){case c('Keys').TAB:this.handleTab(event);return;case c('Keys').UP:this.view.prev();break;case c('Keys').DOWN:this.view.next();break;case c('Keys').ESC:this.view.reset();break;default:setTimeout(this.checkValue.bind(this),0);return;}event.kill();};j.prototype.keypress=function(event){'use strict';if(this.view.getSelection()&&c('Event').getKeyCode(event)==c('Keys').RETURN){this.view.select();event.kill();}};j.prototype.handleTab=function(event){'use strict';if(this.preventFocusChangeOnTab)if(this.view.getSelection()){event.kill();}else event.prevent();this.view.select();};j.prototype.select=function(k){'use strict';if(k&&this.setValueOnSelect){var l=k.orig_text||k.text;this.setValue(l);this.setHiddenValue(k.uid);this.selectedText=l;c('CSS').addClass(this.inputWrap,'selected');}};j.prototype.afterSelect=function(){'use strict';this.keepFocused?c('Focus').set(this.element):this.element.blur();this.resetOnSelect?this.reset():this.view.reset();};j.prototype.unselect=function(){'use strict';if(this.setValueOnSelect){this.selectedText=null;c('CSS').removeClass(this.inputWrap,'selected');}this.setHiddenValue();this.inform('unselect',this);};j.prototype.setEnabled=function(k){'use strict';var l=k===false;this.element.disabled=l;c('CSS').conditionClass(this.root,'uiTypeaheadDisabled',l);};j.prototype.reset=function(){'use strict';this.unselect();this.setValue();!this.keepFocused&&c('Input').reset(this.element);this.view.reset();this.inform('reset');};j.prototype.getElement=function(){'use strict';return this.element;};j.prototype.setExclusions=function(k){'use strict';this._exclusions=k.map(String);};j.prototype.getExclusions=function(){'use strict';return this._exclusions;};j.prototype.setValue=function(k){'use strict';this.value=this.nextQuery=k||'';c('Input').setValue(this.element,this.value);c('StickyPlaceholderInput').update(this.element);this.inform('change',k);};j.prototype.setHiddenValue=function(k){'use strict';this.hiddenInput.value=k||k===0?k:'';c('Arbiter').inform('Form/change',{node:this.hiddenInput});};j.prototype.getValue=function(){'use strict';return c('Input').getValue(this.element);};j.prototype.getHiddenValue=function(){'use strict';return this.hiddenInput.value||'';};j.prototype.checkValue=function(){'use strict';var k=this.getValue();if(k==this.value)return;if(this.selectedText&&this.selectedText!=k)this.unselect();var l=Date.now(),m=l-this.time;this.time=l;this.value=this.nextQuery=k;this.inform('change',this.value);this.performQuery(m);};j.prototype.performQuery=function(k){'use strict';if(this.selectedText)return;k=k||0;if(this.fetching&&k<this.queryTimeout){this.data.query(this.nextQuery,true,this._exclusions,k);}else{this.data.query(this.nextQuery,false,this._exclusions,k);this.nextQuery=null;}};j.prototype.updateHeight=function(){'use strict';};Object.assign(j.prototype,{events:['blur','focus','click','unselect','loading','change'],keepFocused:true,resetOnSelect:false,resetOnKeyup:true,setValueOnSelect:false,queryTimeout:250,preventFocusChangeOnTab:false});f.exports=j;},null);
__d('PluginFlyoutDialog',['Arbiter','DOMEvent','DOMEventListener','PluginFlyout'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j,k){this.parent=new (c('PluginFlyout'))(i,j,k);this.flyout=i;c('Arbiter').subscribe(c('PluginFlyout').SHOW,this.show.bind(this),c('Arbiter').SUBSCRIBE_NEW);}Object.assign(h.prototype,{show:function(){if(this.subscribed)return;this.subscribed=1;var i=window.ServerJSAsyncLoader;i&&i.ondemandjs&&i.run(i.ondemandjs);c('DOMEventListener').add(this.flyout.parentNode,'click',function(j){j=new (c('DOMEvent'))(j);if(j.target===this.flyout.parentNode){j.kill();this.parent.hide();}}.bind(this));}});f.exports=h;},null);
__d('TypeaheadBestName',['FamilyMentionsData','TokenizeUtil'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){'use strict';this._typeahead=i;}h.prototype.enable=function(){'use strict';var i=this._typeahead.getView(),j=this._getAvailableAlternateNameFields();this._subscription=i.subscribe('beforeRender',function(k,l){var m=l.value;for(var n=0;n<l.results.length;++n){var o=l.results[n],p=this._getNameToDisplay(o,m,j);if(p!==null){o.text=p;if(o.hasOwnProperty('default_name')&&o.text!==o.default_name){o.subtext=o.default_name;}else o.subtext=null;}}}.bind(this));};h.prototype.disable=function(){'use strict';this._typeahead.getView().unsubscribe(this._subscription);this._subscription=null;};h.prototype._getNameToDisplay=function(i,j,k){'use strict';if(i.hasOwnProperty('default_name')&&c('TokenizeUtil').isQueryMatch(j,i.default_name))return i.default_name;for(var l=0;l<k.length;l++){var m=i[k[l]];if(m==undefined)continue;for(var n=0;n<m.length;n++){var o=m[n];if(c('TokenizeUtil').isQueryMatch(j,o))return o;}}if(i.hasOwnProperty('default_name'))return i.default_name;return null;};h.prototype._getAvailableAlternateNameFields=function(){'use strict';var i=['alternate_names'];if(c('FamilyMentionsData').allowFamilyNames)i.push('family_names');return i;};Object.assign(h.prototype,{_subscription:null});f.exports=h;},null);
__d('legacy:BestNameTypeaheadBehavior',['TypeaheadBestName'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();if(!b.TypeaheadBehaviors)b.TypeaheadBehaviors={};b.TypeaheadBehaviors.buildBestAvailableNames=function(h){h.enableBehavior(c('TypeaheadBestName'));};},3);
__d('MentionsInputMatchers',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=['@','\\uff20'].join(''),i=['#','\\uFF03'].join(''),j='.,+*?$|#{}()\\^\\-\\[\\]\\\\\/!%\'"~=<>_:;\n\r',k=j.replace('#','')+'&',l='\u200B';function m(p,q){'use strict';this.$Matchers1=p;this.$Matchers2=q;this.$Matchers3();}m.prototype.$Matchers3=function(){'use strict';var p=this.$Matchers4(this.$Matchers2),q=this.$Matchers5(this.$Matchers1,this.$Matchers2),r=this.$Matchers6(this.$Matchers1,q),s=this.$Matchers7(p,r),t=this.$Matchers8(p);this.$Matchers9=new RegExp('['+this.$Matchers1+']$');this.$Matchers10=new RegExp(r+'$');this.$Matchers11=new RegExp(t+'$');this.$Matchers12=new RegExp(s+'$');this.$Matchers13=new RegExp('['+i+']');};m.prototype.$Matchers4=function(p){'use strict';return '\\b[A-Z][^ A-Z'+p+l+']';};m.prototype.$Matchers5=function(p,q){'use strict';return '(?:[^'+p+q+']|['+q+'][^ '+q+'])';};m.prototype.$Matchers6=function(p,q){'use strict';return '(?:^|\\s)(['+p+']('+q+'{0,20}))';};m.prototype.$Matchers7=function(p,q){'use strict';return '(?:(?:^|[^#])('+p+'+)|'+q+')';};m.prototype.$Matchers8=function(p){'use strict';return '(?:'+p+'{4,})';};m.prototype.getMainMatcher=function(){'use strict';return this.$Matchers10;};m.prototype.getTriggerMatcher=function(){'use strict';return this.$Matchers9;};m.prototype.getAutoMatcher=function(){'use strict';return this.$Matchers12;};m.prototype.getHashtagMatcher=function(){'use strict';return this.$Matchers13;};var n='\\b[A-Z][^ A-Z'+j+']',o={mentionsMatchers:new m(h,j),hashtagMatchers:new m(i,k),userMatcher:new RegExp('(?:'+n+'{4,})'+'$')};f.exports=o;},null);
__d('MentionsInput',['cx','Arbiter','ArbiterMixin','Bootloader','CSS','DataStore','DOM','Event','FbtResult','FlipDirection','Input','InputSelection','Keys','MentionsInputMatchers','Parent','Style','TokenizeUtil','UserAgent_DEPRECATED','htmlize','mixin','removeFromArray'],function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();var k='\u200B',l=new RegExp(k,'g'),m=function(v){return v+k;},n=function(v){return v.replace(/(@+)(\[[0-9]+\:([^\]]|\\\])*\]+)/g,'$1 $2');},o=/[\\\]:]/g,p={MENTIONS:'mentions',HASHTAGS:'hashtags'};function q(v,w){return v.replace(w,' '.repeat(w.length));}function r(v,w){return v.substring(0,w)+v.substring(w+1);}function s(v){var w=v.lastIndexOf('>');if(w>=0){var x=v.indexOf(' ',w);return x>=0?v.substr(0,x+1):v;}else return '';}function t(v,w,x){var y=x.lastIndexOf('<',w)>x.lastIndexOf('>',w);return y?' ':'&nbsp;<wbr />';}i=babelHelpers.inherits(u,c('mixin')(c('ArbiterMixin')));j=i&&i.prototype;function u(v,w,x,y,z,aa){'use strict';j.constructor.call(this);c('DataStore').set(v,'MentionsInput',this);this._root=v;this._typeahead=w;this._input=x;this._offsets=[];var ba=null,ca=this.init.bind(this,y,z,aa);try{ba=document.activeElement===this._input;}catch(da){}if(ba){setTimeout(ca,0);}else var ea=c('Event').listen(this._input,'focus',function(){setTimeout(ca,0);ea.remove();});this._hasHashtags=y.hashtags;this._hashtagsDataSource=y.hashtags_data_source;this._mentionsDataSource=this._typeahead.getData();this._currentDataSource=this._mentionsDataSource;this._autoSuggestPages=y.autosuggest_pages;this._lastHighlighterHTML='';this._hashtags=[];this._matchers=c('MentionsInputMatchers').mentionsMatchers;this._setMatchersMode(p.MENTIONS);}u.prototype.init=function(v,w,x){'use strict';if(this._initialized)return;this._initValue=w?w.value:'';this._highlighter=c('DOM').find(this._root,'.highlighter');this._highlighterInner=this._highlighter.firstChild;this._highlighterContent=c('DOM').find(this._root,'.highlighterContent');this._hiddenInput=c('DOM').find(this._root,'.mentionsHidden');this._placeholder=this._input.getAttribute('placeholder')||'';this._metrics=x;if(!this._hiddenInput.name){var y=this._input.name;this._input.name=y+'_text';this._hiddenInput.name=y;}this._initEvents();this._initTypeahead();if(w===null){this._setup();}else this.reset(w);this.inform('init',null,c('Arbiter').BEHAVIOR_STATE);this._initialized=true;};u.prototype._setup=function(){'use strict';this._mentioned={};this._orderedUIDs=[];this._numMentioned=0;this._filterData=null;this._highlighterContent&&c('DOM').empty(this._highlighterContent);this._highlighterAuxContent&&c('DOM').remove(this._highlighterAuxContent);this._highlighterAuxContent=null;c('Input').setPlaceholder(this._input,this._placeholder);c('Style').set(this._typeahead.getElement(),'height','auto');};u.prototype.reset=function(v){'use strict';this._setup();var w=v&&v.value||'';this._value=w;this._hiddenInput&&(this._hiddenInput.value=w);if(this._input&&v)c('Input').setValue(this._input,v.value);var x=v&&v.mentions;if(x&&x.length){var y=[];x.forEach(function(z){y.push(z.offset+z.length);delete z.offset;delete z.length;this._addToken(z);},this);y.reverse().forEach(function(z){w=w.substring(0,z)+k+w.substring(z);});}c('Input').setValue(this._input,w);if(this._value==='')c('FlipDirection').setDirection(this._input);this._update();};u.prototype.getValue=function(){'use strict';return c('Input').getValue(this._input).replace(l,'');};u.prototype._getMarkedValue=function(){'use strict';return c('Input').getValueRaw(this._input);};u.prototype.getRawValue=function(){'use strict';this._update();return c('Input').getValue(this._hiddenInput);};u.prototype.checkValue=function(){'use strict';var v=this._typeahead.getCore().getValue();if(this._matchers.getTriggerMatcher().exec(v)||v==='')this.inform('sessionEnd',{});};u.prototype.getTypeahead=function(){'use strict';return this._typeahead;};u.prototype.hasChanges=function(){'use strict';return !c('Input').isEmpty(this._input)&&this._input.value!==this._initValue&&this._initialized;};u.prototype.focus=function(){'use strict';this._input.focus();};u.prototype._initEvents=function(){'use strict';var v=this._update.bind(this);c('Event').listen(this._input,{input:v,keyup:v,change:v,blur:this._handleBlur.bind(this),focus:this._handleFocus.bind(this),keydown:this._handleKeydown.bind(this)});if(this._metrics){this._metrics.init(this._typeahead);this._metrics._reset();this._metrics.bindSessionStart(this._typeahead,'render',true);this._metrics.bindSessionEnd(this._typeahead.getView(),'select',true);this._metrics.bindSessionEnd(this,'sessionEnd',false);c('Event').listen(this._input,'keyup',function(event){setTimeout(this.checkValue.bind(this),0);}.bind(this));}};u.prototype._initTypeahead=function(){'use strict';this._typeahead.subscribe('select',function(aa,ba){var ca=ba.selected;this._addToken({uid:ca.uid,text:ca.text,type:ca.type,weakreference:ca.weak_reference});this.updateValue();}.bind(this));var v=this._input,w=null;function x(){if(w===null){w=c('Input').getSubmitOnEnter(v);c('Input').setSubmitOnEnter(v,false);}}function y(){if(w!==null){c('Input').setSubmitOnEnter(v,w);w=null;}}this._typeahead.subscribe('reset',y);this._typeahead.subscribe('render',x);this._typeahead.subscribe('highlight',function(aa,ba){ba.index>=0?x():y();});this._typeahead.subscribe('query',function(){this._filterData=null;}.bind(this));var z=this._typeahead.getCore();z.suffix=k;this._handleFocus();};u.prototype._handleBlur=function(){'use strict';if(this._filterToken){this._filterToken.remove();this._filterToken=null;}};u.prototype._handleFocus=function(){'use strict';if(!this._filterToken)this._filterToken=this._typeahead.getData().addFilter(this._filterResults.bind(this));this._updateWidth();};u.prototype._handleKeydown=function(event){'use strict';var v=event.keyCode;if(v==c('Keys').BACKSPACE||v==c('Keys').DELETE)this._handleBackspaceAndDelete(event,v);if(v==c('Keys').LEFT||v==c('Keys').RIGHT)setTimeout(this._handleLeftAndRight.bind(this,v),10);};u.prototype._handleLeftAndRight=function(v){'use strict';var w=this._getMarkedValue(),x=c('InputSelection').get(this._input),y=x.start,z=x.end,aa=v==c('Keys').LEFT,ba=v==c('Keys').RIGHT;if(y==z){var ca=aa?-1:1;if(w.charAt(y)==k)c('InputSelection').set(this._input,y+ca);}else if(aa&&w.charAt(y)==k){c('InputSelection').set(this._input,y-1,z);}else if(aa&&w.charAt(z)==k){c('InputSelection').set(this._input,y,z-1);}else if(ba&&w.charAt(z)==k){c('InputSelection').set(this._input,y,z+1);}else if(ba&&w.charAt(y)==k)c('InputSelection').set(this._input,y+1,z);};u.prototype._handleBackspaceAndDelete=function(event,v){'use strict';var w=c('InputSelection').get(this._input),x=false;if(w.start!==w.end)if(this._offsetIsInsideMention(w.start+1)&&this._offsetIsInsideMention(w.end)){x=v===c('Keys').BACKSPACE;}else return;var y=v===c('Keys').DELETE?1:-1,z=y+(x?w.end:w.start),aa=this._getMarkedValue(),ba=aa;for(var ca=0;ca<this._orderedUIDs.length;++ca){var da=this._mentioned[this._orderedUIDs[ca]],ea=da.text,fa=m(ea),ga=ba.indexOf(fa),ha=ga+fa.length;if(z<ga||z>=ha){ba=q(ba,fa);continue;}var ia,ja;if(da.type!='user'){ia=0;ja=[ea];}else{ia=fa.substring(0,z-ga).split(' ').length-1;ja=ea.split(' ');}var ka=ja.splice(ia,1)[0],la=ja.join(' '),ma=ia===0?ga:ha-ka.length-1;if(la){da.text=la;la=m(la);}else this._removeToken(da.uid);var na=aa.substring(0,ga)+la+aa.substring(ha);c('Input').setValue(this._input,na);c('InputSelection').set(this._input,ma);this._update();event.kill();break;}};u.prototype._offsetIsInsideMention=function(v){'use strict';for(var w=0;w<this._offsets.length;w++)if(v>this._offsets[w][0]&&v<=this._offsets[w][1])return true;return false;};u.prototype._filterResults=function(v){'use strict';if(this._filterData===null){var w=c('InputSelection').get(this._input).start;if(this._offsetIsInsideMention(w)){this._filterData={caretIsInsideMention:true};return false;}var x=this._typeahead.getCore();this._filterData={value:x.getValue(),rawValue:x.getRawValue()};}if(this._filterData.caretIsInsideMention)return false;if(this._matchers.getMainMatcher().test(this._filterData.rawValue))return true;if(v.type!='user'&&!v.connected_page)return false;if(v.disable_autosuggest)return false;if(this._matchersMode===p.MENTIONS&&c('MentionsInputMatchers').userMatcher.test(this._filterData.value))return true;return c('TokenizeUtil').isExactMatch(this._filterData.value,this._typeahead.getData().getTextToIndex(v));};u.prototype._addToken=function(v){'use strict';var w=v.uid;if(!this._mentioned.hasOwnProperty(w)){this._mentioned[w]=v;var x=this._orderedUIDs,y=n(this._getMarkedValue()),z=y.indexOf(m(this._mentioned[w].text)),aa=false,ba=0;for(var ca=0;ca<x.length;++ca){var da=m(this._mentioned[x[ca]].text),ea=y.indexOf(da,ba);ba=ea+da.length;if(z<ea){this._orderedUIDs.splice(ca,0,w);aa=true;break;}}if(!aa)this._orderedUIDs.push(w);this._numMentioned++;this._update();}};u.prototype._removeToken=function(v){'use strict';if(this._mentioned.hasOwnProperty(v)){delete this._mentioned[v];c('removeFromArray')(this._orderedUIDs,v);this._numMentioned--;this._update();}};u.prototype._update=function(v){'use strict';v=v||{};var w=this._getMarkedValue();this._checkShouldSwapDataSource(w);if(w==this._value)return;this._value=w;this._updateTypeahead();this._updateMentions();this._updateWidth();setTimeout(this._updateDirection.bind(this),0);this.updateValue();var x=this.hasAuxContent();this.inform('valueUpdate',{value:w,hasAuxContent:x});};u.prototype._updateMentions=function(){'use strict';this._offsets=[];var v=this._getMarkedValue(),w=v;for(var x=0;x<this._orderedUIDs.length;++x){var y=this._orderedUIDs[x],z=m(this._mentioned[y].text),aa=w.indexOf(z);if(aa==-1)this._removeToken(y);w=q(w,z);this._offsets.push([aa,aa+z.length]);}var ba=v;while((aa=w.indexOf(k))>-1){ba=r(ba,aa);w=r(w,aa);}if(v!==ba){var ca=c('InputSelection').get(this._input);c('Input').setValue(this._input,ba);c('InputSelection').set(this._input,ca.start);this._value=ba;}};u.prototype._renderHashtags=function(v){'use strict';this._initHashtagParser(v);if(!this._hasHashtags||!this._hashtagParser)return c('htmlize')(v);this._hashtags=this._hashtagParser.parse(v);var w=[],x=0;for(var y=0;y<this._hashtags.length;y++){var z=this._hashtags[y];w.push(c('htmlize')(v.substring(x,z.rawOffset)),'<b>',z.marker,z.tag,'</b>');x=z.rawOffset+z.marker.length+z.tag.length;}w.push(c('htmlize')(v.substring(x)));return w.join('');};u.prototype.updateValue=function(){'use strict';var v=this._value=this._getMarkedValue(),w=this._orderedUIDs,x=n(v);for(var y=0;y<w.length;++y){var z='@['+w[y]+':]',aa=m(this._mentioned[w[y]].text);x=x.replace(aa,z);v=v.replace(aa,z);}var ba=this._renderHashtags(v);for(var y=0;y<w.length;++y){var ca=w[y],da=this._mentioned[ca],ea=da.text,fa=da.weakreference?'<b class="weak">':'<b>';ba=ba.replace('@['+ca+':]',fa+c('htmlize')(m(ea))+'</b>');ea=ea.replace(o,function(ha){return '\\'+ha;});x=x.replace('@['+ca+':]','@['+ca+':'+ea+']');}var ga=s(ba);if(this._highlighterAuxContent||ga!==this._lastHighlighterHTML){if(c('UserAgent_DEPRECATED').ie()<9)ba=ba.replace(/ /g,t);this._highlighterContent.innerHTML=ba;this._updateHighlighter();this._lastHighlighterHTML=ga;}this._hiddenInput.value=x;this._updateHeight();};u.prototype._updateDirection=function(){'use strict';var v=c('Style').get(this._input,'direction');if(v==this._dir)return;this._dir=v;c('Style').set(this._highlighter,'direction',v);if(v=='rtl'){c('Style').set(this._highlighter,'text-align','right');}else c('Style').set(this._highlighter,'text-align','left');};u.prototype._updateWidth=function(){'use strict';var v=this._input.offsetWidth;if(v===this._lastInputWidth)return;this._lastInputWidth=v;var w=c('Style').getFloat.bind(null,this._input),x=v-w('paddingLeft')-w('paddingRight')-w('borderLeftWidth')-w('borderRightWidth');this._highlighterInner.style.width=Math.max(x,0)+'px';};u.prototype._updateHeight=function(){'use strict';if(this._highlighterAuxContent){var v=this._highlighter.offsetHeight,w=this._typeahead.getElement();if(v>w.offsetHeight){this._typeahead.setHeight(v);c('Arbiter').inform('reflow');}}};u.prototype._updateTypeahead=function(){'use strict';var v=this._typeahead.getCore();v.matcher=this._matchers.getAutoMatcher();v.setExclusions(this._orderedUIDs);this.inform('update',{mentioned:this._mentioned});};u.prototype.setPlaceholder=function(v){'use strict';this._placeholder=v instanceof c('FbtResult')?v.toString():v;if(!this.hasAuxContent())c('Input').setPlaceholder(this._input,this._placeholder);};u.prototype._updateHighlighter=function(){'use strict';if(this._highlighterContent)c('CSS').conditionShow(this._highlighterContent,this._numMentioned>0||this.hasAuxContent()||this._hashtags.length);};u.prototype.setAuxContent=function(v){'use strict';if(this._highlighterContent){if(!this._highlighterAuxContent){this._highlighterAuxContent=c('DOM').create('span',{className:"highlighterAuxContent"});c('DOM').insertAfter(this._highlighterContent,this._highlighterAuxContent);}c('DOM').setContent(this._highlighterAuxContent,v);if(v){c('Input').setPlaceholder(this._input,'');}else c('Input').setPlaceholder(this._input,this._placeholder);this._value=null;this._update();this._updateHighlighter();this._updateHeight();}};u.prototype.hasAuxContent=function(){'use strict';var v=this.getAuxContentRoot();return v&&c('CSS').shown(v)&&v.innerHTML.length>0;};u.prototype.getAuxContentRoot=function(){'use strict';return this._highlighterAuxContent;};u.prototype.addMention=function(v,w){'use strict';w=typeof w==='undefined'?true:w;var x=w===false?'':' ',y=this._getMarkedValue();if(y!=='')y+=' ';c('Input').setValue(this._input,y+m(v.text)+x);this._addToken(v);this._update();};u.prototype.getMentions=function(){'use strict';return this._mentioned;};u.prototype.bootloadHashtagParser=function(){'use strict';if(!this._hashtagParser)c('Bootloader').loadModules(["HashtagParser"],function(v){this._hashtagParser=v;if(this._initialized){this._value=null;this._update();}}.bind(this),'MentionsInput');};u.getInstance=function(v){'use strict';var w=c('Parent').byClass(v,'uiMentionsInput');return w?c('DataStore').get(w,'MentionsInput'):null;};u.prototype._checkShouldSwapDataSource=function(v){'use strict';this._initHashtagParser(v);if(!this._hashtagsDataSource||!this._hashtagParser)return;var w=this._isInsideHashtagToken(v);if(this._matchersMode===p.HASHTAGS&&!w){this._setMatchersMode(p.MENTIONS);this._swapData(this._mentionsDataSource);}else if(this._matchersMode===p.MENTIONS&&w){this._setMatchersMode(p.HASHTAGS);this._swapData(this._hashtagsDataSource);}};u.prototype._swapData=function(v){'use strict';this._currentDataSource=v;this._typeahead.swapDataNoCoreReset(this._currentDataSource);this._metrics.data=this._currentDataSource;this._metrics.initEvents();};u.prototype._isInsideHashtagToken=function(v){'use strict';this._hashtags=this._hashtagParser.parse(v);var w=c('InputSelection').get(this._input).start;for(var x=0;x<this._hashtags.length;x++){var y=this._hashtags[x],z=y.offset;if(w>=z&&w<=z+y.tag.length+1)return true;}return false;};u.prototype._initHashtagParser=function(v){'use strict';if(this._hashtagParser)return;if(this._matchers.getHashtagMatcher().exec(v))this.bootloadHashtagParser();};u.prototype._setMatchersMode=function(v){'use strict';switch(v){case p.MENTIONS:this._matchers=c('MentionsInputMatchers').mentionsMatchers;break;case p.HASHTAGS:this._matchers=c('MentionsInputMatchers').hashtagMatchers;break;default:throw new Error('MatchersMode enum is missing constant '+v);}this._matchersMode=v;};f.exports=u;},null);
__d('legacy:MentionsInput',['MentionsInput'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();b.MentionsInput=c('MentionsInput');},3);
__d('TypeaheadAreaCore',['InputSelection','TextAreaControl','TypeaheadCore','emptyFunction'],function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('TypeaheadCore'));i=h&&h.prototype;function j(k){'use strict';i.constructor.call(this,k);this.matcher=new RegExp(this.matcher+'$');this.preventFocusChangeOnTab=true;}j.prototype.select=function(k){'use strict';i.select.call(this,k);var l=this.element.value,m=this.prefix+k.text+this.suffix;this.expandBounds(l,m);var n=l.substring(0,this.start),o=l.substring(this.end);this.element.value=n+m+o;c('InputSelection').set(this.element,n.length+m.length);};j.prototype.expandBounds=function(k,l){'use strict';k=k.toLowerCase();l=l.toLowerCase();var m,n,o,p,q=/\s/;n=k.substring(this.start,this.end);o=l.indexOf(n);m=this.start;while(m>=0&&o>=0){p=k.charAt(m-1);if(!p||q.test(p))this.start=m;n=p+n;o=l.indexOf(n);m--;}n=k.substring(this.start,this.end);o=l.indexOf(n);m=this.end;while(m<=k.length&&o>=0){p=k.charAt(m);if(!p||q.test(p))this.end=m;n=n+p;o=l.indexOf(n);m++;}};j.prototype.getRawValue=function(){'use strict';var k=c('InputSelection').get(this.element).start||0;return i.getValue.call(this).substring(0,k);};j.prototype.getValue=function(){'use strict';var k=this.matcher&&this.matcher.exec(this.getRawValue());if(!k)return '';var l=k[0],m=k.index+l.length;l=l.replace(/^\s/,'');var n=l.length;l=l.replace(/\s$/,'');var o=n-l.length;this.start=m-n;this.end=m+o;if(k[2]&&(k[2].charAt(0)==='#'||k[2].charAt(0)==='\\uFF03'))return k[2];return k[3]||k[1]||k[0];};j.prototype.updateHeight=function(){'use strict';var k=c('TextAreaControl').getInstance(this.element);k.updateHeight();};Object.assign(j.prototype,{prefix:'',suffix:', ',matcher:"\\b[^,]*",click:c('emptyFunction')});f.exports=j;},null);
__d('TypeaheadHoistFriends',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){'use strict';this._typeahead=i;}h.prototype.enable=function(){'use strict';var i=this._typeahead.getView();this._subscription=i.subscribe('beforeRender',function(j,k){var l=[],m=[],n=[];for(var o=0;o<k.results.length;++o){var p=k.results[o];if(p.type=='header'){n=n.concat(m,l);n.push(p);m=[];l=[];}else if(p.type=='user'&&p.bootstrapped){m.push(p);}else l.push(p);}k.results=n.concat(m,l);});};h.prototype.disable=function(){'use strict';this._typeahead.getView().unsubscribe(this._subscription);this._subscription=null;};Object.assign(h.prototype,{_subscription:null});f.exports=h;},null);
__d('legacy:HoistFriendsTypeaheadBehavior',['TypeaheadHoistFriends'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();if(!b.TypeaheadBehaviors)b.TypeaheadBehaviors={};b.TypeaheadBehaviors.hoistFriends=function(h){h.enableBehavior(c('TypeaheadHoistFriends'));};},3);
__d('TypeaheadMetrics',['AsyncRequest','Event','QueriesHistory','emptyFunction'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=1000;function i(j){'use strict';this.extraData={};Object.assign(this,j);}i.prototype.init=function(j){'use strict';this.init=c('emptyFunction');this._initImpl(j);};i.prototype._initImpl=function(j){'use strict';this.core=j.getCore();this.view=j.getView();this.data=j.getData();this.queriesHistory=new (c('QueriesHistory'))(h);this.stats={};this.sessionActive=false;this._sessionStartEvents=[];this._sessionEndEvents=[];this._reset();this.initEvents();};i.prototype._reset=function(){'use strict';this.log=[];this.stats={};this.avgStats={};this.sessionActive=false;this._setSid(Math.floor(Date.now()*Math.random()));this.request_ids=[];this.lastNotBackspacedQuery='';this.queriesHistory.reset();this._logEvent('session_started',{});};i.prototype._logEvent=function(j,k){'use strict';var l={type:j,data:k,time:Date.now()};this.log.push(l);};i.prototype._setSid=function(j){'use strict';this.sid=j;if(typeof this.data.queryData==='object'&&this.data.queryData!==null){this.data.queryData.sid=this.sid;}else this.data.setQueryData({sid:this.sid});if(typeof this.data.bootstrapData==='object'&&this.data.bootstrapData!==null){this.data.bootstrapData.sid=this.sid;}else this.data.setBootstrapData({sid:this.sid});};i.prototype.resetWithData=function(j){'use strict';this.init=c('emptyFunction');this._initImpl(j);};i.prototype.resetWithDataBeforeSessionEnd=function(j){'use strict';var k=this.sessionActive;this.init=c('emptyFunction');this._initImpl(j);this.sessionActive=k;};i.prototype.recordSelect=function(j){'use strict';var k=j.selected;if(k.uid==null){this.recordStat('selected_id','SELECT_NULL');}else this.recordStat('selected_id',k.uid);this.recordStat('selected_type',k.type);this.recordStat('selected_score',k.score);this.recordStat('selected_original_id',k.original_id);this.recordStat('place_id',k.place_id);this.recordStat('client_time',k.client_time);this.recordStat('selected_position',j.index);this.recordStat('selected_with_mouse',j.clicked?1:0);this.recordStat('selected_query',j.query);this._sessionEnd();};i.prototype.bindSessionStart=function(j,event,k){'use strict';if(k)for(var l=0;l<this._sessionStartEvents.length;++l){var m=this._sessionStartEvents[l];m.obj.unsubscribe(m.token);}this._sessionStartEvents.push({obj:j,token:j.subscribe(event,function(n,o){this._sessionStart();}.bind(this))});};i.prototype.bindSessionEnd=function(j,event,k){'use strict';if(k)for(var l=0;l<this._sessionEndEvents.length;++l){var m=this._sessionEndEvents[l];m.obj.unsubscribe(m.token);}this._sessionEndEvents.push({obj:j,token:j.subscribe(event,function(n,o){this._sessionEnd();}.bind(this))});};i.prototype.dataSubscribe=function(j,k){'use strict';var l=this.data,m=this.data.subscribe(j,k);this._dataSubscriptions.push(function(){l.unsubscribe(m);});};i.prototype.initEvents=function(){'use strict';this._dataSubscriptions=this._dataSubscriptions||[];this._dataSubscriptions.forEach(function(j){j();});this._dataSubscriptions=[];this.bindSessionStart(this.core,'focus',false);this.bindSessionEnd(this.core,'blur',false);this.view.subscribe('select',function(j,k){this.recordSelect(k);}.bind(this));this.bindSessionEnd(this.view,'select',false);this.view.subscribe('render',function(j,k){this.results=k;}.bind(this));this.dataSubscribe('beforeQuery',function(j,k){this._logEvent('user_typed',{query:k.value});if(!k.value)return;this.query=k.value;this.queriesHistory.add(this.query);if(this.lastNotBackspacedQuery.indexOf(this.query)!==0)this.lastNotBackspacedQuery=this.query;this.recordCountStat('num_queries');}.bind(this));this.dataSubscribe('beforeFetch',function(j,k){if(k.fetch_context.bootstrap){this.bootstrapBegin=Date.now();}else k.fetch_context.queryBegin=Date.now();this._logEvent('async_query_started',{query:k.fetch_context.value,request_id:k.fetch_context.request_id});}.bind(this));this.dataSubscribe('fetchComplete',function(j,k){this._logEvent('async_query_completed',{query:k.fetch_context.value,request_id:k.fetch_context.request_id});if(k.fetch_context.bootstrap){this.recordAvgStat('bootstrap_latency',Date.now()-this.bootstrapBegin);var l={};k.response.payload.entries.forEach(function(m){if(!l[m.type]){l[m.type]=1;}else l[m.type]++;});this.recordStat('bootstrap_response_types',l);this.bootstrapped=true;}else{if('filtered_count' in k.response.payload)this.recordStat('filtered_count',k.response.payload.filtered_count);this.recordAvgStat('avg_query_latency',Date.now()-k.fetch_context.queryBegin);}}.bind(this));this.dataSubscribe('respond',function(j,k){this._logEvent('respond',{query:k.value,num_results:k.results.length});var l=this.data.tokenizeBackend(k.value||'').flatValue,m=this.data.findBestPreviousQuery(l,this.data.getQueryIDs())||'',n=this.data.getQueryIDs()[m];this.normalized_backend_query=m;this.request_id=n;this.request_ids.push(n);}.bind(this));this.dataSubscribe('dirty',function(j,k){this.bootstrapped=false;}.bind(this));};i.prototype._sessionStart=function(){'use strict';if(this.sessionActive)return;this.sessionActive=true;};i.prototype._sessionEnd=function(){'use strict';if(!this.sessionActive)return;this.sessionActive=false;this.submit();this._reset();};i.prototype.recordStat=function(j,k){'use strict';this.stats[j]=k;};i.prototype.recordCountStat=function(j){'use strict';var k=this.stats[j];this.stats[j]=k?k+1:1;};i.prototype.recordAvgStat=function(j,k){'use strict';if(this.avgStats[j]){this.avgStats[j][0]+=k;++this.avgStats[j][1];}else this.avgStats[j]=[k,1];};i.prototype.hasStats=function(){'use strict';return !!Object.keys(this.stats).length;};i.prototype.submit=function(){'use strict';if('log_all_sessions' in this.extraData||this.hasStats()){Object.assign(this.stats,this.extraData);if(this.results){var j=this.results.map(function(m,n){return m.uid;});this.recordStat('candidate_results',JSON.stringify(j));}if(this.query)this.recordStat('query',this.query);if(this.lastNotBackspacedQuery)this.recordStat('last_not_backspaced_query',this.lastNotBackspacedQuery);this.recordStat('queries_history',JSON.stringify(this.queriesHistory.getQueries()));if(this.normalized_backend_query)this.recordStat('normalized_backend_query',this.normalized_backend_query);if(this.request_id)this.recordStat('request_id',this.request_id);if(this.request_ids.length)this.recordStat('request_ids',this.request_ids);if(this.sid)this.recordStat('sid',this.sid);if(this.bootstrapped)this.recordStat('bootstrapped',1);for(var k in this.avgStats){var l=this.avgStats[k];this.stats[k]=l[0]/l[1];}this.recordStat('log',JSON.stringify(this.log));new (c('AsyncRequest'))().setURI(this.endPoint).setMethod('POST').setData({stats:this.stats}).setErrorHandler(c('emptyFunction')).send();this._reset();}};i.register=function(j,k,l){'use strict';if(document.activeElement===j){k.init(l);}else var m=c('Event').listen(j,'focus',function(){k.init(l);m.remove();});};Object.assign(i.prototype,{endPoint:'/ajax/typeahead/record_basic_metrics.php'});f.exports=i;},null);